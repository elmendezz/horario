<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Admin - Horario y Mensajes</title>
  <style>
    body { font-family: Arial; background: #121212; color: white; text-align: center; }
    .container { margin: 20px auto; padding: 20px; background: #1e1e1e; border-radius: 12px; max-width: 500px; }
    textarea { width: 100%; height: 80px; border-radius: 8px; padding: 10px; }
    button { margin-top: 10px; padding: 10px 20px; border: none; border-radius: 8px; background: #4CAF50; color: white; cursor: pointer; }
    button:hover { background: #45a049; }
    .msg-list { margin-top: 20px; text-align: left; }
    .msg-item { background: #333; padding: 10px; border-radius: 6px; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>Panel de Admin</h2>
  <div class="container">
    <h3>Enviar Mensaje</h3>
    <textarea id="msgInput" placeholder="Escribe un mensaje..."></textarea><br>
    <button onclick="sendMessage()">Enviar</button>
    <div class="msg-list" id="msgList"></div>
  </div>

  <script>
    async function sendMessage() {
      const input = document.getElementById('msgInput');
      const text = input.value.trim();
      if (!text) return;
      const res = await fetch("/api/messages", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text })
      });
      if (res.ok) {
        input.value = "";
        loadMessages();
      } else {
        alert("Error al enviar mensaje");
      }
    }

    async function loadMessages() {
      const res = await fetch("/api/messages");
      const msgs = await res.json();
      const list = document.getElementById("msgList");
      list.innerHTML = "";
      msgs.slice().reverse().forEach(m => {
        const div = document.createElement("div");
        div.className = "msg-item";
        div.innerHTML = `<b>${m.time}</b><br>${m.text}`;
        list.appendChild(div);
      });
    }

    window.onload = loadMessages;
  </script>
</body>
</html>