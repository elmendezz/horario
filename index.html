<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Horario Escolar</title>
    <style>
        /* Version: 18 */
        /* Changelog:
        - Version 17: Replaced the entire schedule with a new, corrected one provided by the user. The new schedule features classes of 50 minutes and a Receso from 3:00 PM to 3:20 PM. This should fix all previous time mismatches.
        - Version 18: Restructured the HTML to move the "Siguiente clase" display outside of the main container and used CSS to position it above the main class display card, as requested by the user.
        */
        
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            color: #333;
            text-align: center;
            padding: 1em;
        }
        .container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2em 1.5em;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            max-width: 90%;
            margin-bottom: 1em;
        }
        #current-class-display {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 0.1em;
            line-height: 1.2;
            word-wrap: break-word;
        }
        #teacher-display {
            font-size: 1.3em;
            color: #666;
            margin-bottom: 0.8em;
        }
        #next-class-display {
            font-size: 0.9em;
            background-color: #e9e9e9;
            padding: 5px 10px;
            border-radius: 10px;
            white-space: nowrap;
            margin-bottom: -15px;
            z-index: 1;
            position: relative;
            transform: translateY(15px);
        }
        #clock {
            font-size: 1.5em;
            font-weight: bold;
            color: #555;
            margin-top: 1em;
        }
        @media (max-width: 600px) {
            .container {
                width: 90%;
                padding: 1.5em 1em;
            }
            #current-class-display {
                font-size: 1.8em;
            }
            #teacher-display {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div id="next-class-display">Siguiente clase: Cargando...</div>
    <div class="container">
        <div id="current-class-display">Cargando horario...</div>
        <div id="teacher-display"></div>
    </div>
    <div id="clock"></div>

    <script>
        // Version: 18
        // Changelog:
        // - Version 17: Replaced the entire schedule with a new, corrected one provided by the user. The new schedule features classes of 50 minutes and a Receso from 3:00 PM to 3:20 PM. This should fix all previous time mismatches.
        // - Version 18: Restructured the HTML to move the "Siguiente clase" display outside of the main container and used CSS to position it above the main class display card, as requested by the user.

        const schedule = [
            // Lunes (1)
            [
                { time: [12, 20], name: "Cultura Digital I", teacher: "Armenta Felix Ana Cristina", duration: 50 },
                { time: [13, 20], name: "Ingles I", teacher: "Falcón Olovanni Andrea Mariel", duration: 50 },
                { time: [14, 10], name: "Ingles I", teacher: "Falcón Olovanni Andrea Mariel", duration: 50 },
                { time: [15, 0], name: "Receso", teacher: "¡A descansar!", duration: 20 },
                { time: [15, 20], name: "Humanidades I", teacher: "Yañez Núñez Lorena Esmeralda", duration: 50 },
                { time: [16, 10], name: "Lengua y Comunicación I", teacher: "Yañez Núñez Lorena Esmeralda", duration: 50 },
                { time: [17, 0], name: "La Materia y sus Interacciones", teacher: "Vara López José Alberto", duration: 50 },
            ],
            // Martes (2)
            [
                { time: [12, 20], name: "Cultura Digital I", teacher: "Armenta Felix Ana Cristina", duration: 50 },
                { time: [13, 20], name: "Cultura Digital I", teacher: "Armenta Felix Ana Cristina", duration: 50 },
                { time: [14, 10], name: "— (Libre)", teacher: "", duration: 50 },
                { time: [15, 0], name: "Receso", teacher: "¡A descansar!", duration: 20 },
                { time: [15, 20], name: "Lengua y Comunicación I", teacher: "Yañez Núñez Lorena Esmeralda", duration: 50 },
                { time: [16, 10], name: "La Materia y sus Interacciones", teacher: "Vara López José Alberto", duration: 50 },
                { time: [17, 0], name: "Ingles I", teacher: "Falcón Olovanni Andrea Mariel", duration: 50 },
            ],
            // Miércoles (3)
            [
                { time: [12, 20], name: "— (Libre)", teacher: "", duration: 50 },
                { time: [13, 20], name: "— (Libre)", teacher: "", duration: 50 },
                { time: [14, 10], name: "Humanidades I", teacher: "Yañez Núñez Lorena Esmeralda", duration: 50 },
                { time: [15, 0], name: "Receso", teacher: "¡A descansar!", duration: 20 },
                { time: [15, 20], name: "Humanidades I", teacher: "Yañez Núñez Lorena Esmeralda", duration: 50 },
                { time: [16, 10], name: "Pensamiento Matemático I", teacher: "Hernández Vargas Keina Yovanna", duration: 50 },
                { time: [17, 0], name: "La Materia y sus Interacciones", teacher: "Vara López José Alberto", duration: 50 },
            ],
            // Jueves (4)
            [
                { time: [12, 20], name: "— (Libre)", teacher: "", duration: 50 },
                { time: [13, 20], name: "Humanidades I", teacher: "Yañez Núñez Lorena Esmeralda", duration: 50 },
                { time: [14, 10], name: "Humanidades I", teacher: "Yañez Núñez Lorena Esmeralda", duration: 50 },
                { time: [15, 0], name: "Receso", teacher: "¡A descansar!", duration: 20 },
                { time: [15, 20], name: "Pensamiento Matemático I", teacher: "Hernández Vargas Keina Yovanna", duration: 50 },
                { time: [16, 10], name: "Pensamiento Matemático I", teacher: "Hernández Vargas Keina Yovanna", duration: 50 },
                { time: [17, 0], name: "Ciencias Sociales I", teacher: "Yañez Núñez Lorena Esmeralda", duration: 50 },
            ],
            // Viernes (5)
            [
                { time: [12, 20], name: "Formación Socioemocional I", teacher: "Chávez Arriola Luis Mario", duration: 50 },
                { time: [13, 20], name: "Ciencias Sociales I", teacher: "Yañez Núñez Lorena Esmeralda", duration: 50 },
                { time: [14, 10], name: "Ciencias Sociales I", teacher: "Yañez Núñez Lorena Esmeralda", duration: 50 },
                { time: [15, 0], name: "Receso", teacher: "¡A descansar!", duration: 20 },
                { time: [15, 20], name: "Lengua y Comunicación I", teacher: "Yañez Núñez Lorena Esmeralda", duration: 50 },
                { time: [16, 10], name: "La Materia y sus Interacciones", teacher: "Vara López José Alberto", duration: 50 },
                { time: [17, 0], name: "Pensamiento Matemático I", teacher: "Hernández Vargas Keina Yovanna", duration: 50 },
            ],
        ];

        let serverTime = null;
        let startTime = Date.now();

        async function fetchTime() {
            try {
                const response = await fetch('http://worldtimeapi.org/api/timezone/America/Tijuana');
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                serverTime = new Date(data.datetime);
            } catch (error) {
                console.error('Error fetching time from API:', error);
                serverTime = new Date(); // Fallback to local time
            }
        }
        
        function updateClock() {
            if (!serverTime) {
                document.getElementById('clock').textContent = 'Sincronizando reloj...';
                return;
            }
            const now = new Date(serverTime.getTime() + (Date.now() - startTime));
            let hours = now.getHours();
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            const am_pm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12;
            document.getElementById('clock').textContent = `Hora: ${hours}:${minutes}:${seconds} ${am_pm}`;
        }
        
        function updateSchedule() {
            if (!serverTime) return;

            const now = new Date(serverTime.getTime() + (Date.now() - startTime));
            const dayOfWeek = now.getDay();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentTimeInMinutes = currentHour * 60 + currentMinute;
            
            const currentClassDisplay = document.getElementById('current-class-display');
            const teacherDisplay = document.getElementById('teacher-display');
            const nextClassDisplay = document.getElementById('next-class-display');

            if (dayOfWeek === 0 || dayOfWeek === 6) {
                currentClassDisplay.textContent = "¡Sin Clases!";
                teacherDisplay.textContent = "Disfruta el fin de semana";
                nextClassDisplay.textContent = "";
                return;
            }

            const todaySchedule = schedule[dayOfWeek - 1];
            let currentClass = "Aún no empiezan las clases";
            let currentTeacher = "";
            let nextClass = "No hay más clases hoy";

            // Encuentra la clase actual y la siguiente
            let foundCurrent = false;
            for (let i = 0; i < todaySchedule.length; i++) {
                const classStartMinutes = todaySchedule[i].time[0] * 60 + todaySchedule[i].time[1];
                const classDuration = todaySchedule[i].duration;
                const classEndMinutes = classStartMinutes + classDuration;

                if (currentTimeInMinutes >= classStartMinutes && currentTimeInMinutes < classEndMinutes) {
                    currentClass = todaySchedule[i].name;
                    currentTeacher = todaySchedule[i].teacher;
                    foundCurrent = true;
                    if (i + 1 < todaySchedule.length) {
                        nextClass = todaySchedule[i + 1].name;
                    } else {
                        nextClass = "Clases terminadas por hoy";
                    }
                    break;
                }
            }
            
            // Si no se encontró una clase actual, busca la siguiente
            if (!foundCurrent) {
                for (let i = 0; i < todaySchedule.length; i++) {
                    const classStartMinutes = todaySchedule[i].time[0] * 60 + todaySchedule[i].time[1];
                    if (currentTimeInMinutes < classStartMinutes) {
                        nextClass = todaySchedule[i].name;
                        break;
                    }
                }
                
                // Si la hora actual es después del final de la última clase
                const lastClassEndMinutes = todaySchedule[todaySchedule.length - 1].time[0] * 60 + todaySchedule[todaySchedule.length - 1].duration;
                if (currentTimeInMinutes >= lastClassEndMinutes) {
                    currentClass = "¡Clases terminadas por hoy!";
                    currentTeacher = "";
                    nextClass = "";
                }
            }

            // Actualiza el display
            currentClassDisplay.textContent = currentClass;
            teacherDisplay.textContent = currentTeacher;
            
            if (nextClass) {
                nextClassDisplay.textContent = `Siguiente clase: ${nextClass}`;
            } else {
                nextClassDisplay.textContent = "";
            }
        }

        fetchTime().then(() => {
            updateSchedule();
            setInterval(updateSchedule, 10000);
            setInterval(updateClock, 100);
        });
    </script>
</body>
</html>